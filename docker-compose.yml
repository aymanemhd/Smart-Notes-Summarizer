version: "3.9"
services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    environment:
      - AI_BASE_URL=${AI_BASE_URL}
      - AI_API_KEY=${AI_API_KEY}
      - AI_MODEL=${AI_MODEL:-mixtral-8x7b-instruct}
      - MAX_NOTE_CHARS=${MAX_NOTE_CHARS:-8000}
      - DB_URL=sqlite:////data/smart_notes.db
      - ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
    volumes:
      - sqlite_data:/data
    ports:
      - "8000:8000"

  client:
    build:
      context: .
      dockerfile: client/Dockerfile
      args:
        - VITE_API_BASE=http://localhost:8000
    ports:
      - "3000:80"
    depends_on:
      - backend

volumes:
  sqlite_data:
